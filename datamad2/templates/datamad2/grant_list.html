{% load staticfiles cookielaw_tags i18n fwtheme_tags %}
{% load routing_classification_icon %}
{% is_container_fluid as container_fluid %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{% block head_title %}All Grants{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    {% block blog_feeds %}
    {% endblock %}

    {% block stylesheets %}
        <link rel="shortcut icon" href="https://nerc.ukri.org/nerc/includes/themes/MasterSite/images/favicon.ico">
        <!-- Bootstrap Core
        CSS -->
        <link rel="stylesheet" href="https://artefacts.ceda.ac.uk/themes/orgtheme_ceda_serv/0.2/4/flatly/bootstrap.css" media="screen">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="https://artefacts.ceda.ac.uk/themes/orgtheme_ceda_serv/0.2/_assets/css/custom.min.css">
        <link rel="stylesheet" href="https://artefacts.ceda.ac.uk/themes/orgtheme_ceda_serv/0.2/_assets/css/org-custom.css">
        <link href="{% static "css/grants.css" %}" rel="stylesheet">
        <!-- data table CSS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/v4-shims.css">

        {# most further customisations can go here, after org theme styling #}
        {% block stylesheets_extra %}{% endblock %}

    {% endblock stylesheets %}

    {% block head_js %}

        <script src="{% static "cookielaw/js/cookielaw.js" %}"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="{% static 'js/table_sorter.js' %}"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    {% endblock head_js %}

    {% block head_js_extra %}{% endblock head_js_extra %}

</head>
<body id="{% block body_id %}body{% endblock body_id %}">

{% block cookielaw_banner %}
    {% if 'cookielaw_accepted' not in request.COOKIES %}

        <div class="container-fluid">
            <div class="alert alert-info text-center" id="CookielawBanner">
                This website uses cookies.
                By continuing to use this website you are agreeing to our use of cookies.&nbsp;
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary"
                            onclick="Cookielaw.createCookielawCookie();">OK</button>

                    <button type="button" class="btn btn-secondary"
                            onclick="window.open('http://www.ceda.ac.uk/privacy-and-cookies/')">Find out more</button>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block navbar_main %}
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
        <div class="container">
            {% block navbar_branding %}
                <a href="https://nerc.ukri.org/" class="navbar-brand">
                    <img src="{% static 'images/UKRI_NER_Council-Logo_Horiz-RGB[W].png' %}" alt="NERC logo" style="width:210px;height:60px;">
                </a>
                <div id="navbarResponsive">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href=""> Home </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'grant_list'%}">Grants</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="">Science Area</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="">My Grants</a>
                        </li>
                        {% if user.is_authenticated %}
                            <li class="nav-item">
                                <a class="nav-link" href="{%  url 'my_account' %}">My Account</a>
                            </li>
                        {%  endif %}
                        &emsp; &emsp;
                    </ul>
                </div>
                <div>
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{%  url 'logout' %}"><i class='fa fa-user-alt'></i>&nbsp;Logout</a>
                        </li>
                    {% else %}
                        <a class="nav-link" href="{%  url 'login' %}"><i class='fa fa-user-alt'></i>&nbsp;Login</a>
                    {% endif %}
                </ul>
                </div>
{#                <a href="https://www.ceda.ac.uk/" class=navbar-brand">#}
{#                    <img src="https://artefacts.ceda.ac.uk/themes/orgtheme_ceda_div/0.3.1/_assets/img/ceda_logo_transp_white_h80.png" alt="CEDA logo" style="width:300px;height:80px;">#}
{#                </a>#}
            {% endblock navbar_branding %}
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
{% endblock navbar_main %}

{% block page_special %}
{% endblock %}

{# To make content occupy full width, override the block page_container #}
{# with one of the same name which OMITS the div class=container tag #}

{% block page_container %}

    <div class="container{% if container_fluid %}-fluid{% endif %}">

    {% block content_main %}
        {% block content_header %}

            <div class="page-header" id="banner">
            <div class="row">
            <div class="col-lg-2 col-md-2 col-sm-2">
                {% block page_title %}
                    <div class="wrapper">
                        <!-- Sidebar -->
                        <nav id="sidebar">
                            <div class="sidebar-header">
                                <h3>DataMAD</h3>
                            </div>
                            <ul class="list-unstyled components">
                                <h4>Grants</h4>
                                <li>
                                    <a href="{% url 'grant_list' %}">All</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=unassigned">Unassigned</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=BODC">BODC</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=CEDA">CEDA</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=EIDC">EIDC</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=NGDC">NGDC</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=PDC">PDC</a>
                                </li>
                                <li>
                                    <a href="{% url 'grant_list' %}?datacentre=ADS">ADS</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                {% endblock %}
            </div>
            <div class="col">
                <table class="row-border" id="grants" style="width:100%">
                    <thead>
                    <tr>
                        <th>Grant Reference</th>
                        <th>Title</th>
                        <th>Assigned Data Centre</th>
                        <th>Other Data Centre </th>
                        <th>Routing Classification</th>
                        <th>Date Added</th>
                        <th>Claim Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for grant in grants %}
                        {%  with imported_grant=grant.importedgrant_set.first %}
                        <tr>
                            <td>
                                <a href="{% url 'grant_detail' pk=imported_grant.pk %}">
                                {{ imported_grant.grant_ref}}
                                </a>
                            </td>
                            <td> {{ imported_grant.title }}</td>
                            {%  if imported_grant.grant.assigned_data_centre %}
                                <td> {{ imported_grant.grant.assigned_data_centre }}</td>
                            {%  else  %}
                                <td> Unassigned </td>
                            {%  endif %}
                            {%  if imported_grant.grant.other_data_centre %}
                                <td> {{ imported_grant.grant.other_data_centre }}</td>
                            {%  else  %}
                                <td> Unassigned </td>
                            {%  endif %}
                            <td> {{ imported_grant.routing_classification|icon }}</td>
                            <td> {{ imported_grant.creation_date }}</td>
                            {%  if imported_grant.grant.claim_status %}
                                <td id="claim">CLAIMED </td>
                            {% else %}
                                <td><a href="{% url 'claim' pk=imported_grant.grant.pk %}"><button class="btn btn-primary" id="claim"> CLAIM</button></a></td>
                            {%  endif %}

                        </tr>
                        {%  endwith %}
                    {%  endfor %}
                    </tbody>
                </table>
            </div>

        {% endblock content_header %}
    {% endblock content_main %}

</div>

{% endblock page_container %}

{% block footer %}
    <footer>
        <div class="container">
            <div class="row d-flex justify-content-around border border-light border-bottom-0 border-left-0 border-right-0 pt-5 pb-2 mt-5">
                <div class="col-md-4">
                    <p class="text-center small">
                        Copyright Â© 2018 <a href="http://www.stfc.ac.uk">STFC</a>
                        All Rights Reserved<br>
                        <a href="http://www.ceda.ac.uk/accessibility" target="_blank">Accessibility</a> |
                        <a href="http://www.ceda.ac.uk/disclaimer" target="_blank">Disclaimer</a> |
                        <a href="http://www.ceda.ac.uk/privacy-and-cookies/" target="_blank">Privacy and Cookies</a><br/>
                        <a href="http://www.ceda.ac.uk" target="_blank">CEDA</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>
{% endblock footer %}
</body>
</html>